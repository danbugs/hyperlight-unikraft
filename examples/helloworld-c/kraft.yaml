specification: '0.6'
name: helloworld-hyperlight

unikraft:
  source: https://github.com/danbugs/unikraft.git
  version: hyperlight-platform
  kconfig:
    CONFIG_PLAT_HYPERLIGHT: 'y'
    CONFIG_LIBUKINTCTLR_HYPERLIGHT: 'y'
    CONFIG_HYPERLIGHT_MAX_GUEST_LOG_LEVEL: '0'
    CONFIG_LIBUKDEBUG: 'y'
    CONFIG_LIBUKDEBUG_PRINTK: 'y'
    CONFIG_LIBUKDEBUG_PRINTK_CRIT: 'y'
    CONFIG_LIBUKDEBUG_PRINTK_ERR: 'y'
    CONFIG_LIBUKDEBUG_PRINTK_WARN: 'y'
    CONFIG_LIBUKDEBUG_PRINTK_INFO: 'y'
    CONFIG_LIBUKPRINT_KLVL_INFO: 'y'
    CONFIG_OPTIMIZE_SIZE: 'y'
    CONFIG_LIBVFSCORE: 'y'
    CONFIG_LIBVFSCORE_AUTOMOUNT_CI: 'y'
    CONFIG_LIBVFSCORE_AUTOMOUNT_CI_INITRD: 'y'
    CONFIG_LIBRAMFS: 'y'
    CONFIG_LIBUKCPIO: 'y'
    CONFIG_APPELFLOADER: 'y'
    CONFIG_APPELFLOADER_VFSEXEC: 'y'
    CONFIG_APPELFLOADER_CUSTOMAPPNAME: 'n'
    CONFIG_APPELFLOADER_VFSEXEC_ENVPATH: 'n'
    CONFIG_APPELFLOADER_VFSEXEC_PATH: '/bin/hello'
    CONFIG_LIBPOSIX_ENVIRON_ENVP0: '"PATH=/bin"'
    CONFIG_LIBELF: 'y'
    # Random number support
    CONFIG_LIBUKRANDOM_CMDLINE_SEED: 'y'
    CONFIG_LIBUKRANDOM_GETRANDOM: 'y'
    # Threading support for clean exit
    CONFIG_LIBPOSIX_PROCESS_MULTITHREADING: 'y'
    CONFIG_LIBUKSCHED: 'y'
    CONFIG_LIBUKSCHEDCOOP: 'y'
    CONFIG_LIBUKMPI: 'y'
    CONFIG_LIBUKLOCK: 'y'
    CONFIG_LIBUKLOCK_SEMAPHORE: 'y'
    CONFIG_LIBUKLOCK_MUTEX: 'y'
    CONFIG_LIBUKBOOT_MAINTHREAD: 'y'
    CONFIG_LIBPOSIX_PROCESS_ARCH_PRCTL: 'y'
    # TLS
    CONFIG_LIBCONTEXT: 'y'
    CONFIG_LIBCONTEXT_CLEAR_TBSS: 'y'

libraries:
  app-elfloader:
    source: https://github.com/danbugs/app-elfloader.git
    version: hyperlight-platform
  libelf:
    source: https://github.com/unikraft/lib-libelf.git
    version: staging

targets:
  - architecture: x86_64
    platform: hyperlight
